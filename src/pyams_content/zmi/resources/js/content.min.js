"use strict";void 0===window.$&&(window.$=MyAMS.$);const content={TinyMCE:{initEditor:(e,t)=>{void 0!==window.tinyMCE&&(t.external_plugins=$.extend({},t.external_plugins,{pyams_link:"/--static--/pyams_content/js/tinymce/internal-link/plugin.js",pyams_headers:"/--static--/pyams_content/js/tinymce/headers/plugin.js"}),t.style_formats=[{title:"Headers",items:[{title:"H3 header",format:"h3"},{title:"H4 header",format:"h4"}]},{title:"Blocs",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strike-through",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"sourcecode",format:"code"}]},{title:"Align",items:[{title:"Left",icon:"align-left",format:"alignleft"},{title:"Center",icon:"align-center",format:"aligncenter"},{title:"Right",icon:"align-right",format:"alignright"}]}],t.menubar&&(t.menu=$.extend({},t.menu,{insert:{title:"Insert",items:"link pyams_link inserttable | charmap emoticons hr | pagebreak nonbreaking anchor | insertdatetime"}})),t.toolbar1&&(t.toolbar1="undo redo | pastetext | header-h3 header-h4 styleselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent"),t.toolbar2&&(t.toolbar2="forecolor backcolor | charmap pyams_link link | fullscreen preview print | code"))}},tree:{switchVisibleElement:(e,t)=>{const a=t.node_id,s=$(`tr[data-ams-tree-node-id="${a}"]`),i=$(s.parents("table")),n=$("thead",i),r=$('th[data-ams-column-name="visible"]',n),l=r.index(),o=$("i",$(`td:nth-child(${l+1})`,s)),c=$(`[data-ams-tree-node-id="${s.data("ams-tree-node-parent-id")}"]`);let m;if("TR"===c.get(0).tagName){m=$("i",$(`td:nth-child(${l+1})`,c)).attr("class")}else m=i.data("ams-visible")?"":"text-danger";!0===t.state?o.replaceWith(`<i class="${r.data("ams-icon-on")} ${m}"></i>`):o.replaceWith(`<i class="${r.data("ams-icon-off")} ${m}"></i>`)}},widget:{treeview:{selectFolder:(e,t)=>{$(e.target).siblings('input[type="hidden"]').val(t.id)},unselectFolder:(e,t)=>{$(e.target).siblings('input[type="hidden"]').val(null)}}},pictograms:{initManagerSelection:function(){const e=$(this),t=$('input[type="hidden"]',$(".selected-pictograms",e)).listattr("value");return{selected:JSON.stringify(t)}},switchPictogram:e=>{$("i",e.currentTarget).tooltip("hide");let t=$(e.currentTarget);t.hasClass("pictogram")||(t=t.parents(".pictogram"));const a=$("input",t),s=t.parents(".pictograms"),i=s.parents(".pictograms-manager");if(s.hasClass("available-pictograms")){const e=a.attr("data-ams-pictogram-name");a.removeAttr("data-ams-pictogram-name").attr("name",e),$("a.action i",t).replaceWith($("<i></i>").addClass("fa fa-fw fa-arrow-left hint opaque baseline").attr("data-ams-hint-gravity","se").attr("data-ams-hint-offset","3")),$(".selected-pictograms",i).append(t)}else{const e=a.attr("name");a.removeAttr("name").attr("data-ams-pictogram-name",e),$("a.action i",t).replaceWith($("<i></i>").addClass("fa fa-fw fa-arrow-right hint opaque baseline").attr("data-ams-hint-gravity","se").attr("data-ams-hint-offset","3")),$(".available-pictograms",i).append(t)}},endDrag:(e,t)=>{$(t.source).remove()}},paragraphs:{switchEditor:(e,t)=>{const a=t&&t.object_id?t.object_id:null,s=a?$(".switcher-parent",$(`tr[id="${a}"]`)):$(e.currentTarget),i=$(".switcher",s),n=s.siblings(".editor");i.hasClass("expanded")?MyAMS.core.clearContent(n).then(()=>{n.empty(),i.html('<i class="far fa-plus-square"></i>').removeClass("expanded")}):(i.html('<i class="fas fa-spinner fa-spin"></i>'),MyAMS.require("ajax","helpers").then(()=>{const e=s.parents("tr"),t=e.data("ams-element-name"),a=e.parents("table").data("ams-location");MyAMS.ajax.post(`${a}/get-paragraph-editor.json`,{object_name:t}).then(e=>{const a=e[t];a&&(n.html(a),MyAMS.core.initContent(n).then(()=>{MyAMS.helpers.scrollTo("#content",n,{offset:-15})}))}).finally(()=>{i.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}))},switchAllEditors:e=>{const t=$(e.currentTarget),a=$(".switcher",t),s=t.parents("table"),i=$("tbody",s);a.hasClass("expanded")?($("tr",i).each((e,t)=>{const a=$(".editor",t);MyAMS.core.clearContent(a).then(()=>{a.empty(),$(".switcher",t).html('<i class="far fa-plus-square"></i>').removeClass("expanded")})}),a.html('<i class="far fa-plus-square"></i>').removeClass("expanded")):(a.html('<i class="fas fa-spinner fa-spin"></i>'),MyAMS.require("ajax","helpers").then(()=>{const e=s.data("ams-location");MyAMS.ajax.post(`${e}/get-paragraphs-editors.json`).then(e=>{for(const[t,a]of Object.entries(e)){const e=$(`tr[data-ams-element-name="${t}"]`,i),s=$(".switcher",e);if(!s.hasClass("expanded")){const t=$(".editor",e);t.html(a),MyAMS.core.initContent(t).then(()=>{s.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}}}).finally(()=>{a.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}))},refreshTitle:(e,t)=>{const a=$(`tr[data-ams-element-name="${t.element_name}"]`);$(".title",a).text(t.title)}},galleries:{switchVisibleMedia:(e,t)=>{const a=$(e.currentTarget).parents(".gallery").data("ams-location");MyAMS.require("ajax").then(()=>{MyAMS.ajax.post(`${a}/switch-media-visibility.json`).then(t=>{$(e.currentTarget);t.status})})}},review:{timer:null,interval:3e4,init:()=>{$(document).off("update-comments.ams.content").on("update-comments.ams.content",(e,{count:t})=>{const a=$('a[href="#review-comments.html"]',$("nav"));a.exists()&&$(".badge",a).text(t)});const e=MyAMS.content.review;e.timer=setTimeout(e.getComments,e.interval)},initPage:()=>{MyAMS.require("helpers").then(()=>{const e=$("#review-messages-view"),t=$("li",e).last();e.exists()&&MyAMS.helpers.scrollTo(e,t)})},getComments:()=>{MyAMS.require("ajax","helpers").then(()=>{const e=MyAMS.content.review,t=$('a[href="#review-comments.html"]',$("nav")),a=$(".badge",t);MyAMS.ajax.get("get-comments.json",{count:a.text()||"0"}).then(({status:t,comments:s,count:i},n,r)=>{if(i!==parseInt(a.text())&&(a.removeClass("bg-info").addClass("bg-danger scaled"),a.text(i),setTimeout(()=>{a.removeClass("bg-danger scaled").addClass("bg-info")},1e4)),s){const e=$("#review-messages-view"),t=$("#review-messages");for(const e of s)t.append($(e));MyAMS.helpers.scrollTo(e,$("li",t).last())}e.timer=setTimeout(e.getComments,e.interval)})})}},thesaurus:{changeThesaurus:e=>{const t=$(e.currentTarget).parents("form"),a=$('select[name$=".widgets.thesaurus_name"]',t).val(),s=$('select[name$=".widgets.extract_name"]',t),i=s.data("select2");s.empty(),s.select2("data",null),i.results.clear(),a&&MyAMS.require("ajax").then(()=>{MyAMS.ajax.get("/api/thesaurus/extracts",{thesaurus_name:a}).then(e=>{$("<option />").attr("id","form-widgets-extract_name-novalue").attr("value","--NOVALUE--").text(MyAMS.i18n.NO_SELECTED_VALUE).appendTo(s),$(e.results).each((e,t)=>{$("<option />").attr("id",`form-widgets-extract_name-${e}`).attr("value",t.id).text(t.text).appendTo(s)}),s.val("--NOVALUE--").trigger("change")})})}}};window.MyAMS&&(MyAMS.config.modules.push("content"),MyAMS.content=content,console.debug("MyAMS: content module loaded..."));
