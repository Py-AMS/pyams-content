"use strict";void 0===window.$&&(window.$=MyAMS.$);const content={tree:{switchVisibleElement:(e,t)=>{const a=t.node_id,s=$(`tr[data-ams-tree-node-id="${a}"]`),n=$(s.parents("table")),r=$("thead",n),i=$('th[data-ams-column-name="visible"]',r),o=i.index(),l=$("i",$(`td:nth-child(${o+1})`,s)),c=$(`[data-ams-tree-node-id="${s.data("ams-tree-node-parent-id")}"]`);let d;if("TR"===c.get(0).tagName){d=$("i",$(`td:nth-child(${o+1})`,c)).attr("class")}else d=n.data("ams-visible")?"":"text-danger";!0===t.state?l.replaceWith(`<i class="${i.data("ams-icon-on")} ${d}"></i>`):l.replaceWith(`<i class="${i.data("ams-icon-off")} ${d}"></i>`)}},widget:{treeview:{selectFolder:(e,t)=>{$(e.target).siblings('input[type="hidden"]').val(t.id)},unselectFolder:(e,t)=>{$(e.target).siblings('input[type="hidden"]').val(null)}}},pictograms:{initManagerSelection:function(){const e=$(this),t=$('input[type="hidden"]',$(".selected-pictograms",e)).listattr("value");return{selected:JSON.stringify(t)}},switchPictogram:e=>{$("i",e.currentTarget).tooltip("hide");let t=$(e.currentTarget);t.hasClass("pictogram")||(t=t.parents(".pictogram"));const a=$("input",t),s=t.parents(".pictograms"),n=s.parents(".pictograms-manager");if(s.hasClass("available-pictograms")){const e=a.attr("data-ams-pictogram-name");a.removeAttr("data-ams-pictogram-name").attr("name",e),$("a.action i",t).replaceWith($("<i></i>").addClass("fa fa-fw fa-arrow-left hint opaque baseline").attr("data-ams-hint-gravity","se").attr("data-ams-hint-offset","3")),$(".selected-pictograms",n).append(t)}else{const e=a.attr("name");a.removeAttr("name").attr("data-ams-pictogram-name",e),$("a.action i",t).replaceWith($("<i></i>").addClass("fa fa-fw fa-arrow-right hint opaque baseline").attr("data-ams-hint-gravity","se").attr("data-ams-hint-offset","3")),$(".available-pictograms",n).append(t)}},endDrag:(e,t)=>{$(t.source).remove()}},paragraphs:{switchEditor:e=>{const t=$(e.currentTarget),a=$(".switcher",t),s=t.siblings(".editor");a.hasClass("expanded")?MyAMS.core.clearContent(s).then(()=>{s.empty(),a.html('<i class="far fa-plus-square"></i>').removeClass("expanded")}):(a.html('<i class="fas fa-spinner fa-spin"></i>'),MyAMS.require("ajax","helpers").then(()=>{const e=t.parents("tr"),n=e.data("ams-element-name"),r=e.parents("table").data("ams-location");MyAMS.ajax.post(`${r}/get-paragraph-editor.json`,{object_name:n}).then(e=>{const t=e[n];t&&(s.html(t),MyAMS.core.initContent(s).then(()=>{MyAMS.helpers.scrollTo("#content",s,{offset:-15})}))}).finally(()=>{a.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}))},switchAllEditors:e=>{const t=$(e.currentTarget),a=$(".switcher",t),s=t.parents("table"),n=$("tbody",s);a.hasClass("expanded")?($("tr",n).each((e,t)=>{const a=$(".editor",t);MyAMS.core.clearContent(a).then(()=>{a.empty(),$(".switcher",t).html('<i class="far fa-plus-square"></i>').removeClass("expanded")})}),a.html('<i class="far fa-plus-square"></i>').removeClass("expanded")):(a.html('<i class="fas fa-spinner fa-spin"></i>'),MyAMS.require("ajax","helpers").then(()=>{const e=s.data("ams-location");MyAMS.ajax.post(`${e}/get-paragraphs-editors.json`).then(e=>{for(const[t,a]of Object.entries(e)){const e=$(`tr[data-ams-element-name="${t}"]`,n),s=$(".switcher",e);if(!s.hasClass("expanded")){const t=$(".editor",e);t.html(a),MyAMS.core.initContent(t).then(()=>{s.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}}}).finally(()=>{a.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}))},refreshTitle:(e,t)=>{const a=$(`tr[data-ams-element-name="${t.element_name}"]`);$(".title",a).text(t.title)}},review:{timer:null,interval:3e4,init:()=>{$(document).off("update-comments.ams.content").on("update-comments.ams.content",(e,{count:t})=>{const a=$('a[href="#review-comments.html"]',$("nav"));a.exists()&&$(".badge",a).text(t)});const e=MyAMS.content.review;e.timer=setTimeout(e.getComments,e.interval)},initPage:()=>{MyAMS.require("helpers").then(()=>{const e=$("#review-messages-view"),t=$("li",e).last();e.exists()&&MyAMS.helpers.scrollTo(e,t)})},getComments:()=>{MyAMS.require("ajax","helpers").then(()=>{const e=MyAMS.content.review,t=$('a[href="#review-comments.html"]',$("nav")),a=$(".badge",t);MyAMS.ajax.get("get-comments.json",{count:a.text()||"0"}).then(({status:t,comments:s,count:n},r,i)=>{if(n!==parseInt(a.text())&&(a.removeClass("bg-info").addClass("bg-danger scaled"),a.text(n),setTimeout(()=>{a.removeClass("bg-danger scaled").addClass("bg-info")},1e4)),s){const e=$("#review-messages-view"),t=$("#review-messages");for(const e of s)t.append($(e));MyAMS.helpers.scrollTo(e,$("li",t).last())}e.timer=setTimeout(e.getComments,e.interval)})})}},thesaurus:{changeThesaurus:e=>{const t=$(e.currentTarget).parents("form"),a=$('select[name$=".widgets.thesaurus_name"]',t).val(),s=$('select[name$=".widgets.extract_name"]',t),n=s.data("select2");s.empty(),s.select2("data",null),n.results.clear(),a&&MyAMS.require("ajax").then(()=>{MyAMS.ajax.get("/api/thesaurus/extracts",{thesaurus_name:a}).then(e=>{$("<option />").attr("id","form-widgets-extract_name-novalue").attr("value","--NOVALUE--").text(MyAMS.i18n.NO_SELECTED_VALUE).appendTo(s),$(e.results).each((e,t)=>{$("<option />").attr("id",`form-widgets-extract_name-${e}`).attr("value",t.id).text(t.text).appendTo(s)}),s.val("--NOVALUE--").trigger("change")})})}}};window.MyAMS&&(MyAMS.config.modules.push("content"),MyAMS.content=content,console.debug("MyAMS: content module loaded..."));
